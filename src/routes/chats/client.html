<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Socket.IO 채팅 클라이언트</title>
        <script
            src="https://cdn.socket.io/4.4.1/socket.io.min.js"
            integrity="sha384-fjy8a7VEq4D6hjfrN8HE2b5fXR6ho8Uc6l5t9bNXf0OFO/Q5BdAHhaFZfsWs+ye3"
            crossorigin="anonymous"
        ></script>
        <style>
            body {
                font-family: Arial, sans-serif;
            }
            #messages {
                list-style-type: none;
                margin: 0;
                padding: 0;
            }
            #messages li {
                padding: 8px;
                margin-bottom: 2px;
                background-color: #f3f3f3;
            }
            #message-form {
                display: flex;
            }
            #message-form input {
                flex: 1;
                padding: 10px;
            }
            #message-form button {
                padding: 10px;
            }
        </style>
    </head>
    <body>
        <ul id="messages"></ul>
        <form id="message-form" action="">
            <input id="message-input" autocomplete="off" placeholder="메시지 입력..." /><button>전송</button>
        </form>

        <script>
            const socket = io('http://localhost:3000', {
                auth: {
                    token: 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsImlhdCI6MTcxNDcxODI2OCwiZXhwIjoxNzE0NzYxNDY4fQ.I8btkH8lhHMIoNstnCx94xaU4e_x1wY0NhC6z9_K7tk', // 실제 토큰으로 교체 필요
                },
            });

            // 서버로부터의 메시지를 받을 때
            socket.on('message', function (data) {
                var item = document.createElement('li');
                item.textContent = data.userId + ': ' + data.text;
                document.getElementById('messages').appendChild(item);
                window.scrollTo(0, document.body.scrollHeight);
            });

            // 연결 성공 시
            socket.on('connected', function (data) {
                var item = document.createElement('li');
                item.textContent = data.message;
                document.getElementById('messages').appendChild(item);
            });

            // 에러 메시지 처리
            socket.on('error', function (data) {
                var item = document.createElement('li');
                item.textContent = 'Error: ' + data.message;
                document.getElementById('messages').appendChild(item);
                item.style.color = 'red';
            });

            // 메시지 전송 처리
            var form = document.getElementById('message-form');
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                var messageInput = document.getElementById('message-input');
                if (messageInput.value) {
                    socket.emit('chatting', { msg: messageInput.value });
                    messageInput.value = '';
                }
            });

            // 연결 해제 이벤트 처리
            socket.on('disconnect', function () {
                var item = document.createElement('li');
                item.textContent = '연결이 끊겼습니다.';
                document.getElementById('messages').appendChild(item);
                item.style.color = 'red';
            });
        </script>
    </body>
</html>
